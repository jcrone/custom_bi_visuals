var kpicardCC33C6CDC44C47478B36A84304E1F7B1;(()=>{"use strict";var e={213(e,t,a){a.d(t,{S:()=>c}),a(210);var i=a(674),s=i.z.Tn,n=i.z.Kx;class o extends s{title=new i.z.ks({name:"title",displayName:"Title",value:"",placeholder:"Auto (from measure name)"});showTitle=new i.z.jF({name:"showTitle",displayName:"Show title",value:!0});valueColor=new i.z.sk({name:"valueColor",displayName:"Value color",value:{value:"#11284C"}});decimalPlaces=new i.z.iB({name:"decimalPlaces",displayName:"Decimal places",value:0,options:{minValue:{value:0,type:0},maxValue:{value:20,type:1}}});displayUnits=new i.z.PA({name:"displayUnits",displayName:"Display units",items:[{value:"1",displayName:"None"},{value:"1000",displayName:"Thousands"},{value:"1000000",displayName:"Millions"},{value:"0",displayName:"Auto"}],value:{value:"1",displayName:"None"}});name="card";displayName="Card";slices=[this.title,this.showTitle,this.valueColor,this.decimalPlaces,this.displayUnits]}class l extends s{showVariance=new i.z.jF({name:"showVariance",displayName:"Show variance",value:!0});positiveColor=new i.z.sk({name:"positiveColor",displayName:"Positive color",value:{value:"#0E7C3A"}});negativeColor=new i.z.sk({name:"negativeColor",displayName:"Negative color",value:{value:"#B42318"}});name="variance";displayName="Variance";slices=[this.showVariance,this.positiveColor,this.negativeColor]}class r extends s{showSparkline=new i.z.jF({name:"showSparkline",displayName:"Show sparkline",value:!0});lineColor=new i.z.sk({name:"lineColor",displayName:"Line color",value:{value:"#00539A"}});areaColor=new i.z.sk({name:"areaColor",displayName:"Area fill color",value:{value:"#00539A"}});name="sparkline";displayName="Sparkline";slices=[this.showSparkline,this.lineColor,this.areaColor]}class c extends n{cardSettings=new o;varianceSettings=new l;sparklineSettings=new r;cards=[this.cardSettings,this.varianceSettings,this.sparklineSettings]}},164(e,t,a){a.d(t,{b:()=>n});var i=a(674),s=a(213);class n{target;container;formattingSettings;formattingSettingsService;animationFrame=0;constructor(e){this.formattingSettingsService=new i.O,this.target=e.element,this.container=document.createElement("div"),this.container.className="kpi-card",this.target.appendChild(this.container)}update(e){this.formattingSettings=this.formattingSettingsService.populateFormattingSettingsModel(s.S,e.dataViews?.[0]);const t=e.dataViews?.[0];if(!t?.categorical?.values)return void this.renderMessage("No data");const a=t.categorical.values;let i=null,n=null,o=[],l="",r="",c="";for(const e of a){const t=e.source.roles;t.value&&(l=e.source.displayName,r=e.source.format||"",i=e.values.reduce((e,t)=>e+(Number(t)||0),0),e.values.length>1&&(o=e.values.map(e=>e))),t.target&&(c=e.source.format||"",n=e.values.reduce((e,t)=>e+(Number(t)||0),0)),t.trend&&(o=e.values.map(e=>e))}if(null==i)return void this.renderMessage("Drop a measure");const u=this.formattingSettings.cardSettings,m=this.formattingSettings.varianceSettings,p=this.formattingSettings.sparklineSettings,d=u.title.value||l,v=u.decimalPlaces.value,h=Number(u.displayUnits.value?.value??1);if(this.container.replaceChildren(),u.showTitle.value){const e=document.createElement("div");e.className="kpi-title",e.textContent=d,this.container.appendChild(e)}const g=this.formatNumber(i,v,h,r),y=document.createElement("div");if(y.className="kpi-value",y.style.color=u.valueColor.value.value,y.textContent=g,this.container.appendChild(y),m.showVariance.value&&null!=n){const e=i-n,t=0!==n?e/Math.abs(n)*100:0,a=e>=0,s=a?"kpi-variance--positive":"kpi-variance--negative",o=a?m.positiveColor.value.value:m.negativeColor.value.value,l=a?"▲":"▼",u=a?"+":"",p=document.createElement("div");p.className=`kpi-variance ${s}`,p.style.color=o;const d=document.createElement("span");d.className="kpi-variance__arrow",d.textContent=l;const g=document.createElement("span");g.textContent=`${u}${t.toFixed(1)}%`;const y=document.createElement("span");y.className="kpi-variance__target",y.textContent=`vs ${this.formatNumber(n,v,h,c||r)}`,p.append(d,g,y),this.container.appendChild(p)}const N=o.filter(e=>null!==e&&!isNaN(e));p.showSparkline.value&&N.length>1&&this.container.appendChild(this.renderSparkline(N,p.lineColor.value.value,p.areaColor.value.value)),this.animateCountUp(i,v,h,r);const f=e.viewport.width,S=e.viewport.height,C=Math.min(f/200,S/140,2.5);y.style.fontSize=Math.max(16,32*C)+"px";const b=this.container.querySelector(".kpi-title");b&&(b.style.fontSize=Math.max(10,13*C)+"px")}renderSparkline(e,t,a){const i=Math.min(...e),s=Math.max(...e)-i||1,n=e.map((t,a)=>{const n=2+a/(e.length-1)*196,o=38-(t-i)/s*36;return`${n.toFixed(1)},${o.toFixed(1)}`}).join(" "),o=`2,40 ${n} 198,40`,l="http://www.w3.org/2000/svg",r=document.createElementNS(l,"svg");r.setAttribute("class","kpi-sparkline"),r.setAttribute("viewBox","0 0 200 40"),r.setAttribute("preserveAspectRatio","none");const c=document.createElementNS(l,"polygon");c.setAttribute("points",o),c.setAttribute("fill",a),c.setAttribute("opacity","0.1");const u=document.createElementNS(l,"polyline");return u.setAttribute("class","kpi-sparkline__line"),u.setAttribute("points",n),u.setAttribute("stroke",t),r.append(c,u),r}extractCurrencySymbol(e){if(!e)return"";const t=e.replace(/\\(.)/g,"$1"),a=t.match(/\[\$([^\]-]+)-[^\]]+\]/);if(a?.[1])return a[1];const i=t.match(/[\$\u00A3\u20AC\u00A5\u20B9]/);return i?i[0]:""}formatNumber(e,t,a,i){const s=Number.isFinite(e)?e:0,n=Number.isFinite(t)?Math.min(20,Math.max(0,Math.trunc(t))):0,o=this.normalizeDisplayUnits(a),l=i||"",r=/%/.test(l);let c="",u=1;if(r||0!==o)(r||1!==o)&&!r&&o>=1e3&&(u=o,1e3===o?c="K":1e6===o?c="M":1e9===o&&(c="B"));else{const e=Math.abs(s);e>=1e9?(u=1e9,c="B"):e>=1e6?(u=1e6,c="M"):e>=1e3&&(u=1e3,c="K")}const m=r?100*s:s;return this.extractCurrencySymbol(l)+new Intl.NumberFormat(void 0,{minimumFractionDigits:n,maximumFractionDigits:n}).format(m/u)+c+(r?"%":"")}normalizeDisplayUnits(e){const t=Number.isFinite(e)?Math.trunc(e):0;switch(t){case 0:case 1:case 1e3:case 1e6:case 1e9:return t;default:return 0}}animateCountUp(e,t,a,i){this.animationFrame&&cancelAnimationFrame(this.animationFrame);const s=this.container.querySelector(".kpi-value");if(!s)return;const n=this.formatNumber(e,t,a,i),o=performance.now(),l=r=>{const c=r-o,u=Math.min(c/800,1),m=1-Math.pow(1-u,3),p=e*m;s.textContent=this.formatNumber(p,t,a,i),u<1?this.animationFrame=requestAnimationFrame(l):(s.textContent=n,this.animationFrame=0)};s.textContent=this.formatNumber(0,t,a,i),this.animationFrame=requestAnimationFrame(l)}renderMessage(e){const t=document.createElement("div");t.className="kpi-title",t.textContent=e,this.container.replaceChildren(t)}getFormattingModel(){return this.formattingSettingsService.buildFormattingModel(this.formattingSettings)}}},754(e,t,a){a.d(t,{Kx:()=>o,PA:()=>d,St:()=>l,Tn:()=>r,iB:()=>p,jF:()=>u,ks:()=>v,sk:()=>m});var i=a(639);class s{}class n extends s{}class o{}class l extends s{}class r extends n{}class c extends s{constructor(e){super(),Object.assign(this,e)}getFormattingSlice(e,t){const a=this.type,i=this.name,s={displayName:t&&this.displayNameKey?t.getDisplayName(this.displayNameKey):this.displayName,description:t&&this.descriptionKey?t.getDisplayName(this.descriptionKey):this.description,uid:e+"-"+i};return Object.assign(Object.assign({},s),{control:{type:a,properties:this.getFormattingComponent(e,t)}})}getFormattingComponent(e,t){return{descriptor:i.y(e,this),value:this.value}}getRevertToDefaultDescriptor(e){return[{objectName:e,propertyName:this.name}]}setPropertiesValues(e,t){var a;const s=null===(a=null==e?void 0:e[t])||void 0===a?void 0:a[this.name];this.value=i.D(this,s,this.value)}}class u extends c{constructor(e){super(e),this.type="ToggleSwitch"}}class m extends c{constructor(e){super(e),this.type="ColorPicker"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{defaultColor:this.defaultColor,isNoFillItemSupported:this.isNoFillItemSupported})}}class p extends c{constructor(e){super(e),this.type="NumUpDown"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{options:this.options})}}class d extends c{constructor(e){super(e),this.type="Dropdown"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{items:this.items})}}class v extends c{constructor(e){super(e),this.type="TextInput"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{placeholder:this.placeholder})}}},667(e,t,a){a.d(t,{A:()=>s});var i=a(754);const s=class{constructor(e){this.localizationManager=e}populateFormattingSettingsModel(e,t){var a,s;const n=new e,o=null===(a=null==t?void 0:t.metadata)||void 0===a?void 0:a.objects;return o&&(null===(s=n.cards)||void 0===s||s.forEach(e=>{var t;e instanceof i.St&&(null===(t=e.topLevelSlice)||void 0===t||t.setPropertiesValues(o,e.name)),(e instanceof i.Tn?[e]:e.groups).forEach(t=>{var a,i,s,n;null===(a=t.topLevelSlice)||void 0===a||a.setPropertiesValues(o,e.name),null===(i=null==t?void 0:t.slices)||void 0===i||i.forEach(t=>{null==t||t.setPropertiesValues(o,e.name)}),null===(n=null===(s=null==t?void 0:t.container)||void 0===s?void 0:s.containerItems)||void 0===n||n.forEach(t=>{var a;null===(a=null==t?void 0:t.slices)||void 0===a||a.forEach(t=>{null==t||t.setPropertiesValues(o,e.name)})})})})),n}buildFormattingModel(e){const t={cards:[]};return e.cards.filter(({visible:e=!0})=>e).forEach(e=>{var a;const s={displayName:this.localizationManager&&e.displayNameKey?this.localizationManager.getDisplayName(e.displayNameKey):e.displayName,description:this.localizationManager&&e.descriptionKey?this.localizationManager.getDisplayName(e.descriptionKey):e.description,groups:[],uid:e.name+"-card",analyticsPane:e.analyticsPane},n=e.name;if(e.topLevelSlice){const t=e.topLevelSlice.getFormattingSlice(n,this.localizationManager);t.suppressDisplayName=!0,s.topLevelToggle=t}null===(a=e.onPreProcess)||void 0===a||a.call(e);const o=e instanceof i.Tn;(o?[e].filter(({visible:e=!0})=>e):e.groups.filter(({visible:e=!0})=>e)).forEach(e=>{const t=e.name+"-group",a={displayName:o?void 0:this.localizationManager&&e.displayNameKey?this.localizationManager.getDisplayName(e.displayNameKey):e.displayName,description:o?void 0:this.localizationManager&&e.descriptionKey?this.localizationManager.getDisplayName(e.descriptionKey):e.description,slices:[],uid:t,collapsible:e.collapsible,delaySaveSlices:e.delaySaveSlices,disabled:e.disabled,disabledReason:e.disabledReason};s.groups.push(a);const i={};if(e.container){const s=e.container,o=t+"-container",l={displayName:this.localizationManager&&s.displayNameKey?this.localizationManager.getDisplayName(s.displayNameKey):s.displayName,description:this.localizationManager&&s.descriptionKey?this.localizationManager.getDisplayName(s.descriptionKey):s.description,containerItems:[],uid:o};s.containerItems.forEach(e=>{const t=e.displayNameKey?e.displayNameKey:e.displayName,a=o+t,s={displayName:this.localizationManager&&e.displayNameKey?this.localizationManager.getDisplayName(e.displayNameKey):e.displayName,slices:[],uid:a};this.buildFormattingSlices({slices:e.slices,objectName:n,sliceNames:i,formattingSlices:s.slices}),l.containerItems.push(s)}),a.container=l}if(e.slices){if(e.topLevelSlice){const t=e.topLevelSlice.getFormattingSlice(n,this.localizationManager);t.suppressDisplayName=!0,(null==a.displayName?s:a).topLevelToggle=t}this.buildFormattingSlices({slices:e.slices,objectName:n,sliceNames:i,formattingSlices:a.slices})}}),s.revertToDefaultDescriptors=this.getRevertToDefaultDescriptor(e),t.cards.push(s)}),t}buildFormattingSlices({slices:e,objectName:t,sliceNames:a,formattingSlices:i}){null==e||e.filter(({visible:e=!0})=>e).forEach(e=>{const s=null==e?void 0:e.getFormattingSlice(t,this.localizationManager);s&&(void 0===a[e.name]?a[e.name]=0:(a[e.name]++,s.uid=`${s.uid}-${a[e.name]}`),i.push(s))})}getRevertToDefaultDescriptor(e){var t;const a={},s=[];let n,o=[];return e instanceof i.St&&e.topLevelSlice&&s.push(...null===(t=e.topLevelSlice)||void 0===t?void 0:t.getRevertToDefaultDescriptor(e.name)),(e instanceof i.Tn?[e].filter(({visible:e=!0})=>e):e.groups.filter(({visible:e=!0})=>e)).forEach(t=>{var i,l;n=this.getSlicesRevertToDefaultDescriptor(e.name,t.slices,a,t.topLevelSlice),null===(l=null===(i=t.container)||void 0===i?void 0:i.containerItems)||void 0===l||l.forEach(t=>{o=o.concat(this.getSlicesRevertToDefaultDescriptor(e.name,t.slices,a))}),s.push(...n.concat(o))}),s}getSlicesRevertToDefaultDescriptor(e,t,a,i){let s=[];return i&&(a[i.name]=!0,s=s.concat(i.getRevertToDefaultDescriptor(e))),null==t||t.forEach(t=>{t&&!a[t.name]&&(a[t.name]=!0,s=s.concat(t.getRevertToDefaultDescriptor(e)))}),s}}},674(e,t,a){a.d(t,{O:()=>s.A,z:()=>i});var i=a(754),s=a(667)},639(e,t,a){function i(e,t){return{objectName:e,propertyName:t.name,selector:t.selector,altConstantValueSelector:t.altConstantSelector,instanceKind:t.instanceKind}}function s(e,t,a){return null==t||"object"==typeof t&&!t.solid?a:t.solid?{value:null==t?void 0:t.solid.color}:"Dropdown"===(null==e?void 0:e.type)&&e.items?e.items.find(e=>e.value==t):t}a.d(t,{D:()=>s,y:()=>i})},210(e){e.exports=null}},t={};function a(i){var s=t[i];if(void 0!==s)return s.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,a),n.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};(()=>{a.r(i),a.d(i,{default:()=>n});var e=a(164),t=window.powerbi,s={name:"kpicardCC33C6CDC44C47478B36A84304E1F7B1",displayName:"KPI Card",class:"Visual",apiVersion:"5.3.0",create:t=>{if(e.b)return new e.b(t);throw"Visual instance not found"},createModalDialog:(e,t,a)=>{const i=globalThis.dialogRegistry;e in i&&new i[e](t,a)},custom:!0};void 0!==t&&(t.visuals=t.visuals||{},t.visuals.plugins=t.visuals.plugins||{},t.visuals.plugins.kpicardCC33C6CDC44C47478B36A84304E1F7B1=s);const n=s})(),kpicardCC33C6CDC44C47478B36A84304E1F7B1=i})();