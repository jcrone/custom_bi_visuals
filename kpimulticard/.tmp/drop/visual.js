var kpimulticard97B3B5AD5E9C45498A34E713F3176C10;(()=>{"use strict";var e={213(e,t,i){i.d(t,{S:()=>r});var a=i(674),s=a.z.Tn,n=a.z.Kx;class o extends s{valueColor=new a.z.sk({name:"valueColor",displayName:"Value color",value:{value:"#11284C"}});decimalPlaces=new a.z.iB({name:"decimalPlaces",displayName:"Decimal places",value:1});displayUnits=new a.z.iB({name:"displayUnits",displayName:"Display units (0=auto, 1=none, 1000=K, 1000000=M)",value:0});columns=new a.z.iB({name:"columns",displayName:"Max columns (0=auto)",value:0});name="card";displayName="Card";slices=[this.valueColor,this.decimalPlaces,this.displayUnits,this.columns]}class l extends s{showVariance=new a.z.jF({name:"showVariance",displayName:"Show variance",value:!0});positiveColor=new a.z.sk({name:"positiveColor",displayName:"Positive color",value:{value:"#0E7C3A"}});negativeColor=new a.z.sk({name:"negativeColor",displayName:"Negative color",value:{value:"#B42318"}});name="variance";displayName="Variance";slices=[this.showVariance,this.positiveColor,this.negativeColor]}class r extends n{cardSettings=new o;varianceSettings=new l;cards=[this.cardSettings,this.varianceSettings]}},164(e,t,i){i.d(t,{b:()=>n});var a=i(674),s=i(213);class n{target;container;formattingSettings;formattingSettingsService;animationFrames=[];constructor(e){this.formattingSettingsService=new a.O,this.target=e.element,this.container=document.createElement("div"),this.container.className="kpi-multi-container",this.target.appendChild(this.container)}update(e){this.formattingSettings=this.formattingSettingsService.populateFormattingSettingsModel(s.S,e.dataViews?.[0]);const t=e.dataViews?.[0];if(!t?.categorical?.categories?.[0])return void(this.container.innerHTML='<div class="kpi-mini-card__title">Add a KPI Name field</div>');const i=t.categorical,a=i.categories[0].values,n=i.values||[],o=[];for(let e=0;e<a.length;e++){const t={name:String(a[e]),value:0,target:null};for(const i of n){const a=i.source.roles;a.value&&(t.value=i.values[e]),a.target&&(t.target=i.values[e])}o.push(t)}const l=this.formattingSettings.cardSettings,r=this.formattingSettings.varianceSettings,c=l.decimalPlaces.value,d=l.displayUnits.value,m=l.columns.value;let u="";for(const e of o){const t=this.formatNumber(e.value,c,d);let i="";if(m>0){const e=100/m-2;i=`style="flex-basis:${e}%; max-width:${e}%"`}if(u+=`<div class="kpi-mini-card" ${i}>`,u+=`<div class="kpi-mini-card__title">${this.escapeHtml(e.name)}</div>`,u+=`<div class="kpi-mini-card__value" style="color:${l.valueColor.value.value}">${t}</div>`,r.showVariance.value&&null!==e.target&&void 0!==e.target){const t=e.value-e.target,i=0!==e.target?t/Math.abs(e.target)*100:0,a=t>=0;u+=`<div class="kpi-mini-card__variance ${a?"kpi-mini-card__variance--positive":"kpi-mini-card__variance--negative"}" style="color:${a?r.positiveColor.value.value:r.negativeColor.value.value}">`,u+=`<span class="kpi-mini-card__arrow">${a?"&#9650;":"&#9660;"}</span>`,u+=`<span>${a?"+":""}${i.toFixed(1)}%</span>`,u+="</div>"}u+="</div>"}this.container.innerHTML=u,this.animateCountUps(o,c,d)}animateCountUps(e,t,i){this.animationFrames.forEach(e=>cancelAnimationFrame(e)),this.animationFrames=[],this.container.querySelectorAll(".kpi-mini-card__value").forEach((a,s)=>{const n=e[s];if(!n)return;const o=n.value,l=this.formatNumber(o,t,i),r=80*s,c=performance.now()+r;a.textContent=this.formatNumber(0,t,i);const d=e=>{if(e<c)return void(this.animationFrames[s]=requestAnimationFrame(d));const n=e-c,r=Math.min(n/700,1),m=1-Math.pow(1-r,3),u=o*m;a.textContent=this.formatNumber(u,t,i),r<1?this.animationFrames[s]=requestAnimationFrame(d):a.textContent=l};this.animationFrames[s]=requestAnimationFrame(d)})}formatNumber(e,t,i){let a="",s=1;if(0===i){const t=Math.abs(e);t>=1e9?(s=1e9,a="B"):t>=1e6?(s=1e6,a="M"):t>=1e3&&(s=1e3,a="K")}else 1===i||i>=1e3&&(s=i,1e3===i?a="K":1e6===i?a="M":1e9===i&&(a="B"));return(e/s).toFixed(t)+a}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}getFormattingModel(){return this.formattingSettingsService.buildFormattingModel(this.formattingSettings)}}},754(e,t,i){i.d(t,{Kx:()=>o,St:()=>l,Tn:()=>r,iB:()=>u,jF:()=>d,sk:()=>m});var a=i(639);class s{}class n extends s{}class o{}class l extends s{}class r extends n{}class c extends s{constructor(e){super(),Object.assign(this,e)}getFormattingSlice(e,t){const i=this.type,a=this.name,s={displayName:t&&this.displayNameKey?t.getDisplayName(this.displayNameKey):this.displayName,description:t&&this.descriptionKey?t.getDisplayName(this.descriptionKey):this.description,uid:e+"-"+a};return Object.assign(Object.assign({},s),{control:{type:i,properties:this.getFormattingComponent(e,t)}})}getFormattingComponent(e,t){return{descriptor:a.y(e,this),value:this.value}}getRevertToDefaultDescriptor(e){return[{objectName:e,propertyName:this.name}]}setPropertiesValues(e,t){var i;const s=null===(i=null==e?void 0:e[t])||void 0===i?void 0:i[this.name];this.value=a.D(this,s,this.value)}}class d extends c{constructor(e){super(e),this.type="ToggleSwitch"}}class m extends c{constructor(e){super(e),this.type="ColorPicker"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{defaultColor:this.defaultColor,isNoFillItemSupported:this.isNoFillItemSupported})}}class u extends c{constructor(e){super(e),this.type="NumUpDown"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{options:this.options})}}},667(e,t,i){i.d(t,{A:()=>s});var a=i(754);const s=class{constructor(e){this.localizationManager=e}populateFormattingSettingsModel(e,t){var i,s;const n=new e,o=null===(i=null==t?void 0:t.metadata)||void 0===i?void 0:i.objects;return o&&(null===(s=n.cards)||void 0===s||s.forEach(e=>{var t;e instanceof a.St&&(null===(t=e.topLevelSlice)||void 0===t||t.setPropertiesValues(o,e.name)),(e instanceof a.Tn?[e]:e.groups).forEach(t=>{var i,a,s,n;null===(i=t.topLevelSlice)||void 0===i||i.setPropertiesValues(o,e.name),null===(a=null==t?void 0:t.slices)||void 0===a||a.forEach(t=>{null==t||t.setPropertiesValues(o,e.name)}),null===(n=null===(s=null==t?void 0:t.container)||void 0===s?void 0:s.containerItems)||void 0===n||n.forEach(t=>{var i;null===(i=null==t?void 0:t.slices)||void 0===i||i.forEach(t=>{null==t||t.setPropertiesValues(o,e.name)})})})})),n}buildFormattingModel(e){const t={cards:[]};return e.cards.filter(({visible:e=!0})=>e).forEach(e=>{var i;const s={displayName:this.localizationManager&&e.displayNameKey?this.localizationManager.getDisplayName(e.displayNameKey):e.displayName,description:this.localizationManager&&e.descriptionKey?this.localizationManager.getDisplayName(e.descriptionKey):e.description,groups:[],uid:e.name+"-card",analyticsPane:e.analyticsPane},n=e.name;if(e.topLevelSlice){const t=e.topLevelSlice.getFormattingSlice(n,this.localizationManager);t.suppressDisplayName=!0,s.topLevelToggle=t}null===(i=e.onPreProcess)||void 0===i||i.call(e);const o=e instanceof a.Tn;(o?[e].filter(({visible:e=!0})=>e):e.groups.filter(({visible:e=!0})=>e)).forEach(e=>{const t=e.name+"-group",i={displayName:o?void 0:this.localizationManager&&e.displayNameKey?this.localizationManager.getDisplayName(e.displayNameKey):e.displayName,description:o?void 0:this.localizationManager&&e.descriptionKey?this.localizationManager.getDisplayName(e.descriptionKey):e.description,slices:[],uid:t,collapsible:e.collapsible,delaySaveSlices:e.delaySaveSlices,disabled:e.disabled,disabledReason:e.disabledReason};s.groups.push(i);const a={};if(e.container){const s=e.container,o=t+"-container",l={displayName:this.localizationManager&&s.displayNameKey?this.localizationManager.getDisplayName(s.displayNameKey):s.displayName,description:this.localizationManager&&s.descriptionKey?this.localizationManager.getDisplayName(s.descriptionKey):s.description,containerItems:[],uid:o};s.containerItems.forEach(e=>{const t=e.displayNameKey?e.displayNameKey:e.displayName,i=o+t,s={displayName:this.localizationManager&&e.displayNameKey?this.localizationManager.getDisplayName(e.displayNameKey):e.displayName,slices:[],uid:i};this.buildFormattingSlices({slices:e.slices,objectName:n,sliceNames:a,formattingSlices:s.slices}),l.containerItems.push(s)}),i.container=l}if(e.slices){if(e.topLevelSlice){const t=e.topLevelSlice.getFormattingSlice(n,this.localizationManager);t.suppressDisplayName=!0,(null==i.displayName?s:i).topLevelToggle=t}this.buildFormattingSlices({slices:e.slices,objectName:n,sliceNames:a,formattingSlices:i.slices})}}),s.revertToDefaultDescriptors=this.getRevertToDefaultDescriptor(e),t.cards.push(s)}),t}buildFormattingSlices({slices:e,objectName:t,sliceNames:i,formattingSlices:a}){null==e||e.filter(({visible:e=!0})=>e).forEach(e=>{const s=null==e?void 0:e.getFormattingSlice(t,this.localizationManager);s&&(void 0===i[e.name]?i[e.name]=0:(i[e.name]++,s.uid=`${s.uid}-${i[e.name]}`),a.push(s))})}getRevertToDefaultDescriptor(e){var t;const i={},s=[];let n,o=[];return e instanceof a.St&&e.topLevelSlice&&s.push(...null===(t=e.topLevelSlice)||void 0===t?void 0:t.getRevertToDefaultDescriptor(e.name)),(e instanceof a.Tn?[e].filter(({visible:e=!0})=>e):e.groups.filter(({visible:e=!0})=>e)).forEach(t=>{var a,l;n=this.getSlicesRevertToDefaultDescriptor(e.name,t.slices,i,t.topLevelSlice),null===(l=null===(a=t.container)||void 0===a?void 0:a.containerItems)||void 0===l||l.forEach(t=>{o=o.concat(this.getSlicesRevertToDefaultDescriptor(e.name,t.slices,i))}),s.push(...n.concat(o))}),s}getSlicesRevertToDefaultDescriptor(e,t,i,a){let s=[];return a&&(i[a.name]=!0,s=s.concat(a.getRevertToDefaultDescriptor(e))),null==t||t.forEach(t=>{t&&!i[t.name]&&(i[t.name]=!0,s=s.concat(t.getRevertToDefaultDescriptor(e)))}),s}}},674(e,t,i){i.d(t,{O:()=>s.A,z:()=>a});var a=i(754),s=i(667)},639(e,t,i){function a(e,t){return{objectName:e,propertyName:t.name,selector:t.selector,altConstantValueSelector:t.altConstantSelector,instanceKind:t.instanceKind}}function s(e,t,i){return null==t||"object"==typeof t&&!t.solid?i:t.solid?{value:null==t?void 0:t.solid.color}:"Dropdown"===(null==e?void 0:e.type)&&e.items?e.items.find(e=>e.value==t):t}i.d(t,{D:()=>s,y:()=>a})}},t={};function i(a){var s=t[a];if(void 0!==s)return s.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,i),n.exports}i.d=(e,t)=>{for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};(()=>{i.r(a),i.d(a,{default:()=>n});var e=i(164),t=window.powerbi,s={name:"kpimulticard97B3B5AD5E9C45498A34E713F3176C10",displayName:"KPI Multi Card",class:"Visual",apiVersion:"5.3.0",create:t=>{if(e.b)return new e.b(t);throw"Visual instance not found"},createModalDialog:(e,t,i)=>{const a=globalThis.dialogRegistry;e in a&&new a[e](t,i)},custom:!0};void 0!==t&&(t.visuals=t.visuals||{},t.visuals.plugins=t.visuals.plugins||{},t.visuals.plugins.kpimulticard97B3B5AD5E9C45498A34E713F3176C10=s);const n=s})(),kpimulticard97B3B5AD5E9C45498A34E713F3176C10=a})();